<div class="sidebar">
  <h3>Admin Panel</h3>
  <ul>
    <li><a routerLink="/admin">Home</a></li>
    <li><a routerLink="/admin/users">Manage Users</a></li>
    <li><a routerLink="/admin/listings">Manage Listings</a></li>
    <li><a routerLink="/admin/bookings">Manage Bookings</a></li>
    <li><a routerLink="/admin/profile">Profile</a></li>
    <li><a (click)="logout()">Logout</a></li>
  </ul>
</div>

<section class="dashboard-content manage-listings">
  <h2>ðŸ“¦ Manage Listings</h2>

  <!-- âœ… Search Bar -->
  <input [(ngModel)]="searchTerm" placeholder="Search by title, category, or location" class="search-bar" />

  <!-- âœ… Filter Dropdown -->
  <select [(ngModel)]="filterStatus" class="filter-dropdown">
    <option value="">All</option>
    <option value="approved">Approved</option>
    <option value="pending">Pending</option>
    <option value="rejected">Rejected</option>
    <option value="featured">Featured</option>
  </select>

  <!-- âœ… Listings Table -->
  <table class="listings-table">
    <thead>
      <tr>
        <th>Title</th>
        <th>Category</th>
        <th>Location</th>
        <th>Condition</th>
        <th>Price</th>
        <th>Status</th>
        <th>Owner</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let listing of filteredListings().slice((currentPage-1)*pageSize, currentPage*pageSize)">
        
        <!-- Title -->
        <td>{{ listing.title }}</td>

        <!-- Category -->
        <td>{{ listing.category }}</td>

        <!-- Location -->
        <td>{{ listing.location }}</td>

        <!-- Condition -->
        <td>{{ listing.condition }}</td>

        <!-- Price -->
        <td>â‚¹{{ listing.price }}/day</td>

        <!-- Status -->
        <td>{{ listing.approvalStatus }}</td>

        <!-- Owner -->
        <td>{{ listing.owner?.name }}</td>

        <!-- Actions -->
        <td class="actions">
          <button (click)="approveListing(listing._id)">Approve</button>
          <button (click)="rejectListing(listing._id)">Reject</button>
          <button (click)="toggleFeatured(listing)">
            {{ listing.featured ? 'Unfeature' : 'Feature' }}
          </button>
          <button (click)="viewListing(listing)">View Details</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- âœ… Pagination Controls -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
    <span>Page {{ currentPage }}</span>
    <button (click)="nextPage()" [disabled]="currentPage * pageSize >= filteredListings().length">Next</button>
  </div>
</section>

<!-- âœ… Listing Preview + Edit Modal -->
<div class="modal" *ngIf="selectedListing">
  <div class="modal-content">
    <h3>{{ selectedListing.title }}</h3>

    <!-- Default view mode -->
    <div *ngIf="!selectedListing.editing">
      <p><strong>Category:</strong> {{ selectedListing.category }}</p>
      <p><strong>Location:</strong> {{ selectedListing.location }}</p>
      <p><strong>Condition:</strong> {{ selectedListing.condition }}</p>
      <p><strong>Price:</strong> â‚¹{{ selectedListing.price }}/day</p>
      <p><strong>Status:</strong> {{ selectedListing.approvalStatus }}</p>
      <p><strong>Owner:</strong> {{ selectedListing.owner?.name }} ({{ selectedListing.owner?.email }})</p>

      <!-- âœ… Image gallery (scrollable if multiple images) -->
      <div class="image-gallery" *ngIf="selectedListing.images?.length">
        <div class="gallery-scroll">
          <img *ngFor="let img of selectedListing.images"
               [src]="'http://localhost:5000' + img"
               alt="Listing Image"
               class="gallery-image" />
        </div>
      </div>

      <!-- Actions -->
      <div class="modal-actions">
        <button (click)="selectedListing.editing = true">Edit</button>
        <button (click)="closeListing()">Close</button>
      </div>
    </div>

    <!-- Edit mode -->
<div *ngIf="selectedListing.editing">
  <label>Title:</label>
  <input [(ngModel)]="selectedListing.title" />

  <p><strong>Category:</strong> {{ selectedListing.category }}</p> <!-- read-only -->

  <label>Location:</label>
  <input [(ngModel)]="selectedListing.location" />

  <label>Condition:</label>
  <select [(ngModel)]="selectedListing.condition">
    <option value="New">New</option>
    <option value="Like New">Like New</option>
    <option value="Good">Good</option>
    <option value="Fair">Fair</option>
  </select>

  <label>Price (â‚¹/day):</label>
  <input type="number" [(ngModel)]="selectedListing.price" />

  <!-- âœ… Image gallery still visible, but read-only -->
  <div class="image-gallery" *ngIf="selectedListing.images?.length">
    <div class="gallery-scroll">
      <img *ngFor="let img of selectedListing.images"
           [src]="'http://localhost:5000' + img"
           alt="Listing Image"
           class="gallery-image" />
    </div>
  </div>

  <div class="modal-actions">
    <button (click)="saveListing(selectedListing)">Save</button>
    <button (click)="cancelEdit(selectedListing)">Cancel</button>
  </div>
</div>

  </div>
</div>
