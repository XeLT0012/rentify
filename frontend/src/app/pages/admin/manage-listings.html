<div class="sidebar">
  <h3>Admin Panel</h3>
  <ul>
    <li><a routerLink="/admin">Home</a></li>
    <li><a routerLink="/admin/users">Manage Users</a></li>
    <li><a routerLink="/admin/listings">Manage Listings</a></li>
    <li><a routerLink="/admin/bookings">Manage Bookings</a></li>
    <li><a routerLink="/admin/profile">Profile</a></li>
    <li><a (click)="logout()">Logout</a></li>
  </ul>
</div>

<section class="dashboard-content manage-listings">
  <h2>ðŸ“¦ Manage Listings</h2>

  <!-- âœ… Search Bar -->
  <input [(ngModel)]="searchTerm" placeholder="Search by title, category, or location" class="search-bar" />

  <!-- âœ… Listings Table -->
  <table class="listings-table">
    <thead>
      <tr>
        <th>Title</th>
        <th>Category</th>
        <th>Location</th>
        <th>Condition</th>
        <th>Price</th>
        <th>Status</th>
        <th>Owner</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let listing of filteredListings().slice((currentPage-1)*pageSize, currentPage*pageSize)">
  <!-- Title -->
  <td *ngIf="!listing.editing">{{ listing.title }}</td>
  <td *ngIf="listing.editing">
    <input [(ngModel)]="listing.title" placeholder="Edit title" />
  </td>

  <!-- Category (always read-only) -->
<td>{{ listing.category }}</td>

  <!-- Location -->
  <td *ngIf="!listing.editing">{{ listing.location }}</td>
  <td *ngIf="listing.editing">
    <input [(ngModel)]="listing.location" placeholder="Edit location" />
  </td>

  <!-- Condition -->
  <td *ngIf="!listing.editing">{{ listing.condition }}</td>
  <td *ngIf="listing.editing">
    <input [(ngModel)]="listing.condition" placeholder="Edit condition" />
  </td>

  <!-- Price -->
  <td *ngIf="!listing.editing">â‚¹{{ listing.price }}/day</td>
  <td *ngIf="listing.editing">
    <input type="number" [(ngModel)]="listing.price" placeholder="Edit price" />
  </td>

  <!-- Status -->
  <td>{{ listing.approvalStatus }}</td>

  <!-- Owner -->
  <td>{{ listing.owner?.name }}</td>

  <!-- Actions -->
  <td class="actions">
  <button *ngIf="!listing.editing" (click)="editListing(listing)">Edit</button>
  <button *ngIf="listing.editing" (click)="saveListing(listing)">Save</button>
  <button *ngIf="listing.editing" (click)="cancelEdit(listing)">Cancel</button>

  <button (click)="approveListing(listing._id)">Approve</button>
  <button (click)="rejectListing(listing._id)">Reject</button>

  <!-- âœ… Featured toggle -->
  <button (click)="toggleFeatured(listing)">
    {{ listing.featured ? 'Unfeature' : 'Feature' }}
  </button>

  <button (click)="viewListing(listing)">View Details</button>
</td>
</tr>

    </tbody>
  </table>

  <!-- âœ… Pagination Controls -->
  <div class="pagination">
    <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
    <span>Page {{ currentPage }}</span>
    <button (click)="nextPage()" [disabled]="currentPage * pageSize >= filteredListings().length">Next</button>
  </div>
</section>

<!-- âœ… Listing Preview Modal -->
<div class="modal" *ngIf="selectedListing">
  <div class="modal-content">
    <h3>{{ selectedListing.title }}</h3>
    <p><strong>Category:</strong> {{ selectedListing.category }}</p>
    <p><strong>Location:</strong> {{ selectedListing.location }}</p>
    <p><strong>Condition:</strong> {{ selectedListing.condition }}</p>
    <p><strong>Price:</strong> â‚¹{{ selectedListing.price }}/day</p>
    <p><strong>Status:</strong> {{ selectedListing.approvalStatus }}</p>
    <p><strong>Owner:</strong> {{ selectedListing.owner?.name }} ({{ selectedListing.owner?.email }})</p>
    <img *ngIf="selectedListing.image" 
         [src]="'http://localhost:5000' + selectedListing.image" 
         alt="Listing Image" />
    <button (click)="closeListing()">Close</button>
  </div>
</div>
