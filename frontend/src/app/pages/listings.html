<div class="sidebar">
  <h3>User Dashboard</h3>
  <ul>
    <li><a routerLink="/dashboard">Home</a></li>
    <li><a routerLink="/listings">My Listings</a></li>
    <li><a routerLink="/add-listing">Add Listing</a></li>
    <li><a routerLink="/profile">Profile</a></li>
    <li><a routerLink="/bookings">üìë My Bookings</a></li> 
    <li><a (click)="logout()">Logout</a></li>
  </ul>
</div>

<section class="listings">
  <h2>My Listings</h2>

  <div class="grid">
    <div class="card" *ngFor="let item of listings" (click)="openListing(item)">
      <img [src]="'http://localhost:5000' + item.images[0]" alt="Listing image">
      <h3>{{ item.title }}</h3>
      <p>{{ item.description }}</p>
      <strong>‚Çπ{{ item.price }}</strong>
      <p><em>Category:</em> {{ item.category }}</p>
      <small>Posted by: {{ item.owner?.name }}</small>
    </div>
  </div>
</section>

<!-- Modal Popup -->
<div class="modal" *ngIf="expandedListing">
  <div class="modal-content">
    <span class="cancel-btn" (click)="closeModal()">√ó Cancel</span>

    <!-- Normal view -->
    <div *ngIf="!isEditMode">
      <h2>{{ expandedListing.title }}</h2>
      <!-- ‚ùå Removed image here -->
      <p>{{ expandedListing.description }}</p>
      <strong>‚Çπ{{ expandedListing.price }}</strong>
      <p><em>Category:</em> {{ expandedListing.category }}</p>
      <p><em>Location:</em> {{ expandedListing.location }}</p>
      <p><em>Contact Preference:</em> {{ expandedListing.contactPreference }}</p>

      <div class="actions">
        <button (click)="enableEdit()">‚úèÔ∏è Edit</button>
        <button (click)="deleteListing(expandedListing._id)">üóë Delete</button>
      </div>

      <h3>Bookings for this product:</h3>
      <div *ngFor="let booking of expandedBookings" class="booking">
        <p><strong>Renter Name:</strong> {{ booking.renter?.name }}</p>
        <p><strong>Email:</strong> {{ booking.renter?.email }}</p>
        <p><strong>Phone:</strong> {{ booking.renter?.phone }}</p>
        <p><strong>Status:</strong> {{ booking.status }}</p>
        <p><strong>Total Price:</strong> ‚Çπ{{ booking.totalPrice }}</p>
        <p *ngIf="booking.paymentId"><strong>Payment ID:</strong> {{ booking.paymentId }}</p>
        <p><strong>Booked On:</strong> {{ booking.createdAt | date:'medium' }}</p>

        <div class="booking-actions">
          <button (click)="confirmBooking(booking._id)" [disabled]="booking.status === 'confirmed'">‚úÖ Confirm</button>
          <button (click)="rejectBooking(booking._id)" [disabled]="booking.status === 'cancelled'">‚ùå Reject</button>
        </div>
      </div>
    </div>

    <!-- Edit mode -->
    <div *ngIf="isEditMode">
      <h2>Edit Listing</h2>
      <form>
        <label>Title</label>
        <input [(ngModel)]="expandedListing.title" name="title">

        <label>Description</label>
        <textarea [(ngModel)]="expandedListing.description" name="description"></textarea>

        <label>Price</label>
        <input type="number" [(ngModel)]="expandedListing.price" name="price">

        <label>Location</label>
        <input [(ngModel)]="expandedListing.location" name="location">

        <button type="button" (click)="saveListing()">üíæ Save</button>
        <button type="button" (click)="isEditMode=false">Cancel</button>
      </form>
    </div>
  </div>
</div>
