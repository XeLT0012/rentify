<div class="dashboard-wrapper">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h3>Rentify</h3>
    <ul>
      <li><a routerLink="/dashboard">ğŸ  Home</a></li>
      <li><a routerLink="/listings">ğŸ“¦ My Listings</a></li>
      <li><a routerLink="/add-listing">â• Add Listing</a></li>
      <li><a routerLink="/profile">ğŸ‘¤ Profile</a></li>
      <li><a routerLink="/bookings">ğŸ“‘ My Bookings</a></li>
      <li><a (click)="logout()">ğŸšª Logout</a></li>
    </ul>
  </aside>

  <!-- Content -->
  <main class="dashboard-content">
    <h2>ğŸ“‘ My Bookings</h2>

    <div class="booking-grid">
      <div class="booking-card" *ngFor="let booking of bookings">
        <img [src]="'http://localhost:5000' + booking.listing.images[0]" alt="Listing image">

        <h3>{{ booking.listing.title }}</h3>
        <p><strong>Status:</strong> {{ booking.status }}</p>
        <p><strong>Booking Dates:</strong> {{ booking.startDate | date }} â†’ {{ booking.endDate | date }}</p>
        <p><strong>Total Price:</strong> â‚¹{{ booking.totalPrice }}</p>

        <!-- âœ… Payment details -->
        <div *ngIf="booking.paymentId">
          <p><strong>Payment ID:</strong> {{ booking.paymentId }}</p>
          <p><strong>Paid On:</strong> {{ booking.createdAt | date:'medium' }}</p>
        </div>
        <div *ngIf="!booking.paymentId">
          <p><em>Payment not completed yet.</em></p>
        </div>

        <!-- âœ… Reveal agent details only if confirmed -->
        <div *ngIf="booking.status === 'confirmed'; else pendingBlock">
          <p><strong>Agent Name:</strong> {{ booking.listing.owner?.name }}</p>
          <p><strong>Agent Email:</strong> {{ booking.listing.owner?.email }}</p>
          <p><strong>Agent Phone:</strong> {{ booking.listing.owner?.phone }}</p>
          <p><strong>Location:</strong> {{ booking.listing?.location }}</p>
          <p><strong>Contact Preference:</strong> {{ booking.listing?.contactPreference }}</p>
        </div>

        <ng-template #pendingBlock>
          <p><em>Agent details will be revealed once booking is confirmed.</em></p>
        </ng-template>
      </div>
    </div>
  </main>
</div>
